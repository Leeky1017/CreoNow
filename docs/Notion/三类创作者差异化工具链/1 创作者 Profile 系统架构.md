# 1. 创作者 Profile 系统架构

<aside>
🏗️

**核心思想**：CN 不是一个"所有功能堆在一起"的通用工具，而是通过 Profile 系统让不同创作者看到**为自己定制的 CN**。Profile 系统是连接"通用基座"和"领域工具层"的桥梁。

</aside>

---

## 1. Profile 系统总览

### 什么是 Profile？

Profile 是一个**项目级别的配置集合**，决定了 CN 在该项目中激活哪些工具、展示怎样的 UI、使用哪些内置技能和审查规则。

```
┌─────────────────────────────────────────────────────┐
│                  CreoNow 应用                        │
│                                                     │
│  ┌─────────────────────────────────────────────┐    │
│  │            通用基座 (Core)                    │    │
│  │  分层上下文 | 知识图谱 | 记忆 | 技能系统       │    │
│  │  版本管理 | 编辑器 | AI 引擎                   │    │
│  └─────────────────────────────────────────────┘    │
│                      ▲                              │
│                      │ Profile 配置                  │
│                      │                              │
│  ┌────────┐  ┌────────┐  ┌──────────────┐          │
│  │📖 小说  │  │🎬 剧本  │  │📱 自媒体     │          │
│  │Profile │  │Profile │  │  Profile     │          │
│  └────────┘  └────────┘  └──────────────┘          │
│                                                     │
│  ┌─────────────────────────────────────────────┐    │
│  │         🔧 自定义 Profile（高级用户）          │    │
│  └─────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────┘
```

### Profile 的作用域

Profile 是**项目级**的，不是全局的。这意味着：

- 用户可以同时拥有一个小说项目和一个自媒体项目，各自使用不同的 Profile
- 一个项目在创建时选择 Profile，后续可以切换（但会触发工具集重新配置）
- 全局偏好（如 AI 模型选择、快捷键设置）不受 Profile 影响

---

## 2. Profile 配置结构

```tsx
interface CreatorProfile {
  id: string;
  type: 'novelist' | 'screenwriter' | 'creator' | 'custom';
  name: string;                    // "小说模式" / "剧本模式" / "自媒体模式"
  
  // ===== UI 配置 =====
  ui: {
    layout: UILayout;              // 编辑器布局（侧边栏配置、面板位置等）
    sidebar: SidebarConfig;        // 侧边栏显示哪些面板
    toolbar: ToolbarConfig;        // 工具栏显示哪些按钮
    statusBar: StatusBarConfig;    // 状态栏显示哪些信息
  };
  
  // ===== 编辑器配置 =====
  editor: {
    defaultFormat: EditorFormat;   // 默认编辑器格式（富文本 / 剧本格式 / Markdown）
    autoFormatRules: FormatRule[]; // 自动格式化规则
    templates: Template[];         // 内置文档模板
  };
  
  // ===== 技能配置 =====
  skills: {
    enabledBuiltins: string[];     // 启用的内置技能列表
    defaultSkill: string;          // 默认技能（选中文字后的首选操作）
    skillMenuOrder: string[];      // 技能菜单的排序
    disabledSkills: string[];      // 禁用的技能
  };
  
  // ===== 知识图谱配置 =====
  knowledgeGraph: {
    entityTypes: EntityType[];     // 支持的实体类型（角色、地点、道具…）
    relationTypes: RelationType[]; // 支持的关系类型
    autoExtract: boolean;          // 是否自动从文本提取实体
    visualizationType: 'network' | 'timeline' | 'board' | 'none';
  };
  
  // ===== 审查配置 =====
  review: {
    dimensions: ReviewDimension[]; // 启用的审查维度
    strictness: 'relaxed' | 'standard' | 'strict';
    customRules: ReviewRule[];     // 模式特定的审查规则
  };
  
  // ===== 主动感知配置 =====
  proactivePerception: {
    enabledMonitors: string[];     // 启用的监测器
    customMonitors: Monitor[];     // 模式特定的监测器
  };
  
  // ===== 输出配置 =====
  export: {
    formats: ExportFormat[];       // 支持的导出格式
    platforms: PlatformConfig[];   // 平台适配配置
  };
}
```

---

## 3. 三种预设 Profile 的配置对比

| **配置项** | **📖 小说模式** | **🎬 剧本模式** | **📱 自媒体模式** |
| --- | --- | --- | --- |
| **编辑器格式** | 富文本（章节制） | 剧本格式（场景/对白/动作） | 富文本 + Markdown 混合 |
| **侧边栏面板** | 章节大纲、角色面板、伏笔看板、时间线 | 场景卡片、角色台词分析、幕间节奏板 | 内容日历、SEO 面板、平台预览 |
| **默认技能** | 续写 | 对白生成 | 改写优化 |
| **知识图谱实体** | 角色、地点、事件、物品、阵营、时间节点 | 角色、场景、道具、主题、音乐/声效提示 | 话题、关键词、引用来源、数据点 |
| **审查维度** | 设定一致性、风格匹配、叙事连贯、角色声音、伏笔状态 | 格式规范、对白真实性、节奏结构、角色声音、场景连贯 | 可读性、标题吸引力、论证逻辑、SEO 指标 |
| **主动感知** | 一致性守卫、伏笔追踪、节奏分析 | 格式检查、台词量平衡、幕间节奏 | 可读性监测、Hook 强度、关键词密度 |
| **导出格式** | EPUB、PDF、DOCX、TXT | Final Draft (.fdx)、PDF（剧本格式）、Fountain | HTML、Markdown、微信排版、知乎排版 |

---

## 4. Profile 选择流程

### 新建项目时的引导

```
┌─────────────────────────────────────────────┐
│  ✨ 创建新项目                                │
├─────────────────────────────────────────────┤
│                                             │
│  你在创作什么类型的作品？                      │
│                                             │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐    │
│  │  📖 小说  │ │  🎬 剧本  │ │ 📱 自媒体 │    │
│  │          │ │          │ │          │    │
│  │ 长篇叙事  │ │ 影视/舞台 │ │ 文章/专栏 │    │
│  │ 短篇小说  │ │ 短片/微电影│ │ 博客/评论 │    │
│  │ 网文连载  │ │ 动画剧本  │ │ 营销文案  │    │
│  └──────────┘ └──────────┘ └──────────┘    │
│                                             │
│  ┌──────────────────────────────────┐       │
│  │  🔧 自定义模式（高级）              │       │
│  │  从空白开始，自选工具组合            │       │
│  └──────────────────────────────────┘       │
│                                             │
└─────────────────────────────────────────────┘
```

### 选择后的细化配置（可选）

选择主模式后，用户可以进一步细化：

| **主模式** | **细化选项** | **效果** |
| --- | --- | --- |
| 📖 小说 | 长篇 / 短篇 / 网文连载 | 长篇启用完整知识图谱+时间线；短篇简化为轻量版；网文连载增加更新提醒和读者视角分析 |
| 🎬 剧本 | 电影 / 电视剧 / 短片 / 舞台剧 | 电影严格三幕式模板；电视剧支持多集管理；舞台剧增加舞台指示格式 |
| 📱 自媒体 | 深度文章 / 短视频文案 / 营销文案 | 深度文章启用论证逻辑检查；短视频文案启用节奏/时长控制；营销文案增加CTA分析 |

---

## 5. 自定义 Profile（高级用户）

### 混合模式

高级用户可以跨模式组合工具：

```tsx
// 示例：一个写科幻小说的用户，同时需要自媒体模式的可读性分析
const customProfile: CreatorProfile = {
  type: 'custom',
  name: '科幻小说 + 可读性优化',
  
  // 基于小说模式
  ...novelistProfile,
  
  // 混入自媒体模式的可读性审查
  review: {
    dimensions: [
      ...novelistProfile.review.dimensions,
      creatorProfile.review.dimensions.find(d => d.id === 'readability'),
    ],
  },
  
  // 混入自媒体模式的导出格式
  export: {
    formats: [
      ...novelistProfile.export.formats,
      { type: 'wechat', name: '微信公众号' },
    ],
  },
};
```

### Profile 市场（远期）

允许用户分享自定义 Profile：

- 社区贡献的 Profile 模板（如"推理小说专用""历史剧本专用"）
- 包含自定义审查规则、技能链、知识图谱模板
- 一键导入到自己的 CN 中

---

## 6. Profile 与记忆系统的关系

<aside>
💡

**关键设计决策**：Profile 影响记忆系统的学习方向。

</aside>

- **语义记忆的蒸馏维度**随 Profile 变化：
    - 小说模式：蒸馏"叙事风格""角色塑造方式""节奏偏好"
    - 剧本模式：蒸馏"对白风格""场景构建方式""结构偏好"
    - 自媒体模式：蒸馏"论述风格""标题偏好""段落结构"
- **情景记忆的分类标签**随 Profile 变化：
    - 小说模式：按场景类型分（对白/动作/描写/内心独白）
    - 剧本模式：按元素分（对白/动作描写/场景描述/转场）
    - 自媒体模式：按内容段落分（引入/论述/举例/总结/CTA）
- **记忆在 Profile 切换时不会丢失**——它们会被重新组织和呈现，但底层数据是共享的