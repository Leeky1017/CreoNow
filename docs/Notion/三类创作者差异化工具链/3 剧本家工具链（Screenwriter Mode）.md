# 3. 剧本家工具链（Screenwriter Mode）

<aside>
🎬

**定位**：剧本家是 CN 当前设计中**缺口最大**的用户群体。剧本创作有独特的格式规范、结构理论和工作流程，需要大量专用工具。本章定义剧本模式下的完整工具集。

</aside>

---

## 工具矩阵总览

| **工具** | **优先级** | **依赖基座能力** |
| --- | --- | --- |
| 🎞️ 剧本格式化引擎 | P0（核心） | 编辑器（TipTap 扩展） |
| 🃏 场景卡片系统（Beat Sheet） | P0（核心） | 编辑器 + 知识图谱 |
| 🗣️ 角色台词分析器 | P0（核心） | 知识图谱 + AI 引擎 |
| 📈 幕间节奏板 | P1（重要） | 主动感知 |
| 🎭 Table Read 模拟器 | P1（重要） | AI 引擎 |
| 📊 场景拆解表生成器 | P1（重要） | 知识图谱 |
| 📺 多集管理器 | P2（增强） | 项目管理 |
| 🎵 情绪/音效标注系统 | P2（增强） | 编辑器扩展 |

---

## 工具 1：🎞️ 剧本格式化引擎（Screenplay Formatter）

### 设计目标

提供**专业级剧本排版**，支持行业标准格式，让编剧专注于内容创作。

### 支持的格式标准

| **格式标准** | **适用场景** | **核心特征** |
| --- | --- | --- |
| 好莱坞标准格式 | 电影剧本 | Courier 12pt、严格缩进规则、每页约 1 分钟 |
| 中国影视剧本格式 | 国内影视 | 中文排版规范、场/幕分组、镜头提示 |
| 舞台剧格式 | 话剧/音乐剧 | 舞台指示、灯光提示、位置标注 |
| Fountain 语法 | 通用（纯文本） | Markdown 风格的剧本标记语言 |

### 剧本元素类型

```tsx
type ScreenplayElementType =
  | 'scene_heading'        // 场景标题: 内. 咖啡馆 - 白天
  | 'action'               // 动作描写
  | 'character'            // 角色名
  | 'parenthetical'        // 括号提示: （低声地）
  | 'dialogue'             // 对白
  | 'transition'           // 转场: CUT TO: / 切至：
  | 'shot'                 // 镜头: CLOSE UP ON
  | 'dual_dialogue'        // 并列对白（两人同时说话）
  | 'note'                 // 编剧注释（不出现在最终稿中）
  | 'stage_direction'      // 舞台指示（舞台剧专用）
  | 'lighting_cue'         // 灯光提示（舞台剧专用）
  | 'sound_cue';           // 音效提示

interface SceneHeading {
  intExt: 'INT' | 'EXT' | 'INT/EXT' | '内' | '外' | '内/外';
  location: string;
  timeOfDay: string;
  sceneNumber?: number;
}
```

### 智能格式化

编辑器根据**输入上下文自动识别和切换元素类型**：

1. 输入 `内.` 或 `INT.` → 自动识别为场景标题格式
2. 场景标题后回车 → 自动切换到动作描写格式
3. 输入全大写角色名 / 连续两次回车 → 切换到角色名格式
4. 角色名后回车 → 切换到对白格式
5. 对白中输入 `(` → 自动插入括号提示
6. 空行后输入 → 回到动作描写

### 格式化 UI 示例

```
┌──────────────────────────────────────────────────┐
│  第 15 场                                         │
│                                                  │
│  内. 旧书店 - 傍晚                                 │
│                                                  │
│  昏暗的灯光下，书架上落满了灰尘。门铃响了。          │
│                                                  │
│                    林远                            │
│          （环顾四周，有些紧张）                      │
│  老板在吗？我来取一个……东西。                       │
│                                                  │
│  书店老板从书架后探出头来。                          │
│                                                  │
│                   书店老板                         │
│  哦，你就是林远？等你好久了。                       │
│                                                  │
│  书店老板从柜台下取出一封红色信封。                  │
│                                                  │
│                    林远                            │
│  这是……                                          │
│                                                  │
│                              ——切至——             │
│                                                  │
│  状态栏: 第15场 | 页码 23/45 | 预估时长 1:12       │
└──────────────────────────────────────────────────┘
```

---

## 工具 2：🃏 场景卡片系统（Beat Sheet）

### 设计目标

用**卡片化的方式管理剧本结构**，支持经典叙事模板，让编剧在鸟瞰全局和深入场景之间自由切换。

### 支持的叙事结构模板

| **模板** | **结构** | **适用场景** |
| --- | --- | --- |
| 三幕式 | 建置（25%）→ 对抗（50%）→ 解决（25%） | 电影剧本（最通用） |
| Save the Cat! Beat Sheet | 15 个 Beat 节点（开场画面→终场画面） | 商业电影 |
| 英雄之旅（Hero's Journey） | 12 个阶段（日常世界→带着万灵药回归） | 冒险/奇幻/成长题材 |
| 起承转合 | 四段式结构 | 中国传统叙事 / 短片 |
| 序列法（Sequence Method） | 8 个序列，每个 10-15 分钟 | 复杂电影叙事 |
| 电视剧集结构 | 冷开场 → A/B/C 故事线 → 标签场景 | 电视剧集 |

### Beat 卡片数据结构

```tsx
interface BeatCard {
  id: string;
  actNumber: number;
  sequenceNumber?: number;
  beatType: string;                // "Catalyst" / "Midpoint" / "All Is Lost"
  
  title: string;
  description: string;
  linkedScenes: string[];          // 关联的剧本场景 ID
  
  narrativeFunction: string;       // "推动主角做出关键决定"
  emotionalTarget: string;         // "观众感到震惊和同情"
  tensionLevel: number;            // 紧张度 0-10
  
  status: 'concept' | 'outlined' | 'scripted' | 'revised';
  estimatedPageCount: number;
  actualPageCount?: number;
  estimatedMinutes: number;
}
```

### Beat Sheet UI

```
┌──────────────────────────────────────────────────────┐
│  🃏 Beat Sheet — 三幕式           [卡片] [时间线] [表格] │
├──────────────────────────────────────────────────────┤
│                                                      │
│  ┌─── 第一幕：建置 (25%) ─────────────────────────┐  │
│  │  ┌────────┐  ┌────────┐  ┌────────┐  ┌──────┐ │  │
│  │  │ 开场   │  │ 主题   │  │ 铺垫   │  │ 催化 │ │  │
│  │  │ 画面   │  │ 陈述   │  │        │  │ 事件 │ │  │
│  │  │ ✅ 2页 │  │ ✅ 1页 │  │ ✏️ 8页 │  │ ⬜   │ │  │
│  │  └────────┘  └────────┘  └────────┘  └──────┘ │  │
│  │  进度: ████░░ 60% | 页数: 12/25                 │  │
│  └────────────────────────────────────────────────┘  │
│                                                      │
│  ┌─── 第二幕：对抗 (50%) ─────────────────────────┐  │
│  │  ┌────────┐  ┌────────┐  ┌────────┐  ...      │  │
│  │  │ B故事线│  │ 玩乐   │  │ 中点   │           │  │
│  │  │ ⬜     │  │ ⬜     │  │ ⬜     │           │  │
│  │  └────────┘  └────────┘  └────────┘           │  │
│  └────────────────────────────────────────────────┘  │
│                                                      │
│  📊 总预估: 110页 (~110分钟)                          │
│  💡 AI: 第一幕偏长(28%)，建议压缩铺垫段落              │
└──────────────────────────────────────────────────────┘
```

### AI 辅助功能

- **结构分析**：AI 分析剧本是否符合所选模板的结构比例
- **Beat 建议**：基于已有 Beat，建议缺失的叙事节点
- **时长预估**：根据页数和场景密度预估剧本总时长
- **结构警告**："第二幕比例过大（58%），建议在中点前削减副线"

---

## 工具 3：🗣️ 角色台词分析器（Dialogue Analyzer）

### 设计目标

确保每个角色有**独特可辨的声音**——不同角色说话方式应有明显差异。

### 分析维度

```tsx
interface DialogueAnalysis {
  characterId: string;
  characterName: string;
  
  metrics: {
    totalLines: number;             // 总台词数
    totalWords: number;             // 总字数
    avgWordsPerLine: number;        // 平均每句台词字数
    screenTimeRatio: number;        // 台词占全片比例
  };
  
  linguisticProfile: {
    vocabularyLevel: 'colloquial' | 'standard' | 'formal' | 'literary';
    sentenceComplexity: number;     // 句子复杂度 0-10
    questionRatio: number;          // 提问句占比
    incompleteRatio: number;        // 不完整句占比（口语化程度）
    uniquePhrases: string[];        // 口头禅/特有用语
  };
  
  emotionalProfile: {
    dominantEmotion: string;
    emotionalRange: number;         // 情感幅度
  };
  
  interactionPatterns: {
    initiatesConversation: number;  // 主动发起对话频率
    responseLength: 'brief' | 'moderate' | 'verbose';
    conflictStyle: 'direct' | 'passive' | 'avoidant';
  };
}
```

### 可视化对比

```
🗣️ 角色台词对比

              林远        苏晴        陈默        书店老板
台词量       ████████    ███████     ████        ██
             185句       162句       87句        34句

平均句长     ████        ██████      ████████    ██████████
             8字/句      14字/句     18字/句     22字/句

口语化程度   ████████    ████        ██          ██████
             高          中          低          中高

情感幅度     ████████    ██████      ██          ████
             丰富        较丰富      克制        中等

💡 AI 诊断:
├ ⚠️ 陈默的台词过于书面化，与"商人"身份不太匹配
├ 💡 建议给书店老板增加口头禅，增强辨识度
└ 📊 林远台词占比 38%，作为主角是合理的
```

### AI 辅助功能

- **声音一致性检查**：检测角色是否在某些场景中"说了不该说的话"
- **对白去重**：发现不同角色使用了过于相似的表达
- **台词量平衡**：某配角台词过多或过少时提醒
- **潜台词分析**：分析角色说的和想的是否一致

---

## 工具 4：📈 幕间节奏板（Act Rhythm Board）

### 情感节奏曲线

```
📈 情感节奏曲线

张力
10 │                              ★ 高潮
   │                          ╱╲
 8 │                      ╱╱    ╲
   │                  ╱╱          ╲
 6 │          ╱╲  ╱╱                ╲
   │      ╱╱    ╲╱ ← 中点转折         ╲
 4 │  ╱╱                               ╲╲
   │╱  ← 催化事件                          ╲╲
 2 │                                        ╲╲ ← 新平衡
   │ ← 开场                                    ╲
 0 └──────────────────────────────────────────────
   第一幕(25%)     第二幕(50%)        第三幕(25%)

   ── 主线张力  ╌╌ B故事线  ·· 情感线
```

### 节奏问题检测

```tsx
interface RhythmIssue {
  type: 'flat_section'      // 平淡段落过长
      | 'no_relief'         // 持续高张力无喘息
      | 'anticlimactic'     // 高潮段落缺乏力度
      | 'pacing_imbalance'; // 幕间比例失衡
  location: string;
  description: string;
  suggestion: string;
}
```

---

## 工具 5：🎭 Table Read 模拟器

### 设计目标

模拟**剧本围读**体验，帮助编剧在没有演员的情况下"听到"剧本。

### UI 示例

```
┌──────────────────────────────────────────────────┐
│  🎭 Table Read 模拟                   [▶️ 播放]   │
├──────────────────────────────────────────────────┤
│                                                  │
│  场景 15: 内. 旧书店 - 傍晚                        │
│                                                  │
│  🔵 林远:                                        │
│  "老板在吗？我来取一个……东西。"                     │
│    └ 💬 语气: 紧张、犹豫                           │
│    └ 🏷️ [标注: ✏️ "东西"太含糊]                   │
│                                                  │
│  🟢 书店老板:                                     │
│  "哦，你就是林远？等你好久了。"                     │
│    └ 💬 语气: 神秘、从容                           │
│                                                  │
│  [动作] 书店老板从柜台下取出红色信封。              │
│                                                  │
│  🔵 林远:                                        │
│  "这是……"                                       │
│    └ ⏱️ 停顿: 2.5秒（建议让停顿更长）              │
│                                                  │
│  进度: ████████░░ 场景 15/42 | 标注: 3个          │
└──────────────────────────────────────────────────┘
```

### 功能

- **角色声音分配**：为每个角色分配不同的视觉标记（颜色 + 图标）
- **逐场景播放**：按场景顺序展示，模拟围读的时间流
- **实时标注**：围读过程中标注"节奏太慢""对白不自然"等问题
- **停顿分析**：AI 识别对白中的自然停顿点，评估节奏感
- **情感标注**：AI 自动为每句对白标注情感语气

---

## 工具 6：📊 场景拆解表生成器（Scene Breakdown）

### 设计目标

从剧本文本中**自动提取场景信息**，生成制片前期需要的场景拆解表。

### 自动提取的信息

```tsx
interface SceneBreakdown {
  sceneNumber: number;
  sceneHeading: string;            // "内. 旧书店 - 傍晚"
  intExt: string;
  location: string;
  timeOfDay: string;
  estimatedDuration: number;       // 预估时长（分钟）
  pageRange: [number, number];     // 页码范围
  
  // 自动提取
  characters: string[];            // 出场角色
  extras: string[];                // 群众演员
  props: string[];                 // 道具
  vehicles: string[];              // 车辆
  specialEffects: string[];        // 特效需求
  stunts: string[];                // 动作/特技
  music: string[];                 // 音乐提示
  
  // 关联
  plotFunction: string;            // 叙事功能
  emotionalTone: string;           // 情感基调
}
```

### 生成的拆解表

```
📊 场景拆解表

场景  内/外  地点        时段    页数   时长   角色              道具
─────────────────────────────────────────────────────────────────
1    内    林远公寓     清晨    1.5   1:30   林远              手机、照片
2    外    地铁站       早上    0.5   0:30   林远、路人         背包
3    内    办公室       白天    2.0   2:00   林远、陈默、苏晴   文件、电脑
...
15   内    旧书店       傍晚    3.0   3:00   林远、书店老板     红色信封、旧书
...

汇总统计:
├ 总场景数: 42    内景: 28 | 外景: 14
├ 总页数: 108     预估时长: 1:48
├ 拍摄地点: 15 个  需布景: 8 个
├ 主要角色: 5 人   群众演员: 12 场
└ 特殊需求: 2 场动作戏, 1 场特效
```

---

## 工具 7：📺 多集管理器（Series Manager）

### 设计目标

为电视剧编剧提供**跨集管理**能力，追踪多条故事线在不同集数中的推进。

### 核心功能

- **故事线追踪板**：可视化 A/B/C 故事线在每一集中的推进状态
- **集间角色追踪**：角色在哪些集出现、台词量变化、弧光跨集推进
- **集间伏笔管理**：跨集伏笔的埋设与回收追踪
- **季度大纲**：鸟瞰整季剧集的叙事弧线
- **集集模板**：每集自动套用集结构模板（冷开场 → 正文 → 钩子结尾）

### 故事线追踪 UI

```
📺 故事线追踪 — 第一季

         EP01   EP02   EP03   EP04   EP05   EP06
A线      ██████ ████── ──████ ██████ ████── ████████
(林远案)  引入    推进    暂停   高潮    过渡    解决

B线      ███─── ██████ ████── ────── ██████ ████──
(苏晴线)  铺垫   展开    推进   缺席    高潮    收尾

C线      ──────  ███─── ██████ ████── ████── ██████
(暗线)           引入    展开   推进    推进    揭示

⚠️ B线在 EP04 完全缺席，观众可能遗忘该故事线
💡 建议在 EP04 加入一个苏晴的简短场景保持存在感
```

---

## 剧本模式的专属技能

| **技能名称** | **功能** | **触发方式** |
| --- | --- | --- |
| 对白生成 | 基于角色性格和场景上下文生成对白 | 默认技能，快捷键 Tab |
| 动作描写 | 为场景生成简洁有力的动作描写 | 选中位置 → 技能菜单 |
| 对白润色 | 让对白更符合角色声音 | 选中对白 → 技能菜单 |
| 潜台词注入 | 在对白中增加潜台词层次 | 选中对白 → 技能菜单 |
| 场景转写 | 将叙述性描写转换为剧本格式场景 | 选中文字 → 技能菜单 |
| 冲突升级 | 在当前场景中增加戏剧冲突 | 选中场景 → 技能菜单 |
| 场景拆解 | 自动生成当前场景的拆解信息 | 右键菜单 / 手动触发 |

---

## 剧本模式的专属审查维度

在通用审查维度基础上，增加：

1. **格式规范审查**：检查剧本格式是否符合所选标准（缩进、大小写、元素顺序）
2. **对白真实性审查**：检测对白是否过于书面化、不符合口语表达
3. **场景节奏审查**：检查场景内部的对白-动作比例是否合理
4. **角色出场平衡审查**：检测主要角色是否长时间缺席
5. **Show Don't Tell 审查**：检测动作描写中是否过多使用情感形容词（应通过行为展示而非直接描述）
6. **页数/时长审查**：检查各幕的页数比例是否符合结构模板