# 提案：s3-p3-backlog-batch

## 背景

`docs/plans/unified-roadmap.md` 将 `s3-p3-backlog-batch` 定义为 Sprint 3 的 P3 批量治理项：合并处理 A1/A2/A3/A4/A5/A6/A7 共 14 条 Low 级问题。该批次问题单项风险低，但复发密度高、分布跨模块，若继续以“见招拆招”方式修复，会在后续 Sprint 重复产生 `NOISE` 与 `DRIFT` 成本。

## 变更内容

- 按 roadmap 中 14 个 P3 子项建立一一对应修复清单，逐文件完成低风险治理改动。
- 为批处理项补齐“问题类型 -> 防复发断言/规则”映射，避免只做一次性清理。
- 统一记录批处理边界：允许清理噪声与一致性修复，不扩展新功能与新交互。
- 在 cross-module 维度补充可验证场景，确保批处理不破坏现有契约与门禁。

## 受影响模块

- Cross Module Integration（治理层）— 批处理范围定义、回归防线、门禁一致性。
- Workbench / Editor / AI / KG / Document / 工具链相关文件（按 14 子项触达）— 仅做 P3 低危治理改动。

## 依赖关系

- 上游依赖：无（roadmap 标注“独立，任何时间可穿插”）。
- 横向协同：与 `s3-lint-ratchet` 可并行；若同批触达相同文件，需保持“最小改动 + 单一责任”。

## 依赖同步检查（Dependency Sync Check）

- 核对输入：
  - `docs/plans/unified-roadmap.md` 中 `s3-p3-backlog-batch` 条目与 14 子项清单。
  - `openspec/specs/cross-module-integration-spec.md` 的跨模块契约稳定性约束。
- 核对项：
  - 本 change 仅覆盖 Low 级治理项，不引入 Medium/High 扩展修复。
  - 每个子项必须可回溯到审计编号（A1-L-001 ... A7-L-019）。
  - 噪声清理不得改变对外接口、错误码、IPC 通道语义。
- 结论：`NO_DRIFT`（与 Sprint 3 定义一致，可进入 TDD 规划）。

## 踩坑提醒（防复发）

- 批处理时禁止“顺手重构”扩大变更面；超出 14 子项边界必须拆分新 change。
- 清理 TODO/注释类噪声时必须保留可追溯 issue 链接，避免形成新的治理黑洞。
- 同文件存在并发改动时，以契约稳定优先，避免把低危治理变成行为变更。

## 代码问题审计重点

- 低危复发防线 1：杜绝“弱断言假绿”（例如布尔表达式等价断言），统一为精确断言值与边界值校验。
- 低危复发防线 2：杜绝“ADDONLY 清理”导致新旧路径并存，清理后必须保留单一实现来源。
- 低危复发防线 3：杜绝“噪声治理引入漂移”，命名、编码格式、BOM 清理必须配套回归验证。
- 低危复发防线 4：杜绝“资源释放遗漏”，涉及 listener/timer 的修复必须具备释放与回收断言。
- 低危复发防线 5：杜绝“静默降级无信号”，输入校验失败必须返回可审计错误而非吞错。

## 防治标签

- `FAKETEST` `ADDONLY` `NOISE` `DRIFT`

## 不做什么

- 不处理 P1/P2 或 Medium/High 等级问题。
- 不新增功能、不改 UI 交互、不重构主架构。
- 不修改主 spec 正文，仅新增 change 三件套。

## 审阅状态

- Owner 审阅：`PENDING`
