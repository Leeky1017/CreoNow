# 状态清单

> **来源**: DESIGN_DECISIONS.md + AI 前端开发方法论  
> **用途**: 确保所有状态都被正确处理，避免遗漏

---

## 一、通用状态（所有可交互组件 MUST 实现）

| 状态 | 触发方式 | 视觉表现 | 行为 |
|------|----------|----------|------|
| default | 初始状态 | 正常颜色 | 可交互 |
| hover | 鼠标悬停 | 背景/边框变化 | cursor: pointer |
| active | 鼠标按下 | 背景加深 | 按下反馈 |
| focus-visible | Tab 键聚焦 | 显示 focus ring | 键盘可操作 |
| disabled | disabled=true | opacity: 0.5 | cursor: not-allowed, 不可点击 |

**注意**:
- MUST 使用 `:focus-visible` 而非 `:focus`
- 鼠标点击 MUST NOT 显示 focus ring

---

## 二、数据状态（涉及异步数据的组件 MUST 实现）

| 状态 | 触发条件 | 视觉表现 | 用户操作 |
|------|----------|----------|----------|
| loading | 数据加载中 | Skeleton 或 Spinner | 等待 |
| success | 操作成功 | 成功提示（Toast） | 继续操作 |
| error | 操作失败 | 错误提示 + 重试按钮 | 重试或取消 |
| empty | 无数据 | 空状态插图 + 引导文案 | 创建/添加 |

---

## 三、内容边界（MUST 处理）

| 边界类型 | 示例 | 处理方式 |
|----------|------|----------|
| empty | 空字符串 | 显示占位符，设置 min-height |
| minimal | 1-2 个字符 | 正常显示 |
| typical | 标准长度内容 | 正常显示 |
| extreme | 超长文本 | text-overflow: ellipsis 截断 |
| extreme | 超长单词 | overflow-wrap: break-word |
| special | 特殊字符 | 正确转义，防 XSS |

---

## 四、页面级状态清单

### 4.1 Dashboard

| 区域 | 状态 | 显示内容 |
|------|------|----------|
| 项目列表 | 加载中 | Skeleton 卡片 |
| 项目列表 | 空 | 空状态插图 + "创建第一个项目" |
| 项目列表 | 错误 | 错误提示 + 重试按钮 |
| 项目列表 | 正常 | 项目卡片列表 |

### 4.2 编辑器

| 区域 | 状态 | 显示内容 |
|------|------|----------|
| 文件树 | 无项目 | 显示 WelcomeScreen |
| 文件树 | 有项目无文件 | 空状态 + "新建文件" 按钮 |
| 文件树 | 加载中 | Skeleton 列表 |
| 文件树 | 加载失败 | 错误提示 + 重试 |
| 编辑区 | 无文件打开 | 占位提示 |
| 编辑区 | 文件加载中 | 加载动画 |
| 编辑区 | 文件加载失败 | 错误信息 |
| 编辑区 | 文件只读 | 只读标识 |
| 编辑区 | 未保存变更 | 修改标记 (dot) |

### 4.3 AI 面板

| 状态 | 显示内容 |
|------|----------|
| 空会话 | 欢迎文案 + 建议 prompt |
| 等待响应 | 加载动画 |
| 流式输出 | 逐字显示 + 光标 |
| 输出完成 | 完整内容 + 操作按钮 |
| 错误 | 错误提示 + 重试 |

---

## 五、组合状态

某些状态会组合出现，MUST 正确处理：

| 组合 | 处理方式 |
|------|----------|
| loading + disabled | 显示 Spinner，按钮不可点击 |
| error + focusable | 显示错误样式，仍可聚焦修改 |
| selected + disabled | 显示选中样式，但不可取消选中 |
| hover + disabled | 保持禁用样式，不显示 hover 效果 |

---

## 六、空状态设计规范

| 场景 | 插图 | 文案 | 操作 |
|------|------|------|------|
| 空项目列表 | 文档图标 | "开始创建你的第一个项目" | 新建项目按钮 |
| 空文件树 | 文件夹图标 | "暂无文件" | 新建文件按钮 |
| 空搜索结果 | 搜索图标 | "未找到匹配结果" | 修改关键词建议 |
| 空角色列表 | 人物图标 | "暂无角色" | 创建角色按钮 |
| 空 AI 会话 | 对话气泡 | 欢迎语 + 建议 prompt | 预设 prompt 按钮 |

---

## 七、加载状态设计规范

| 场景 | 表现形式 |
|------|----------|
| 页面级加载 | 顶部进度条 (2px 高，动画滚动) |
| 列表加载 | Skeleton 列表项 |
| 卡片加载 | Skeleton 卡片 |
| 按钮加载 | Spinner 替换文字，禁用点击 |
| 输入框加载 | 右侧 Spinner |

---

## 八、错误状态设计规范

| 场景 | 表现形式 | 颜色 |
|------|----------|------|
| 内联错误（表单） | 输入框下方红色文字 | --color-error |
| Toast 通知 | 右上角短暂显示 | --color-error |
| 错误对话框 | 模态框，需用户确认 | --color-error |
| 网络错误 | 全屏错误页 + 重试 | --color-error |

---

## 九、AI 前端开发常见陷阱检查表（36 项）

> 来源: AI 前端开发方法论附录  
> 用途: 组件/页面验收时检查 AI 是否遗漏常见问题

### 9.1 布局类问题（5 项）

| # | 问题 | 预期 | AI 常犯错误 | 正确做法 |
|---|------|------|------------|----------|
| 1 | **容器高度溢出** | 面板内部滚动 | 容器随内容无限延伸 | 设置 `height: 100%` + `overflow-y: auto` |
| 2 | **Flex 子元素溢出** | 子元素不超出父容器 | 子元素撑破容器 | 父容器加 `min-height: 0` 或 `overflow: hidden` |
| 3 | **固定元素被遮挡** | 状态栏始终可见 | 被内容推到屏幕外 | 使用正确的 Flex 布局 |
| 4 | **拖拽分隔条失效** | 可拖拽调整宽度 | 拖拽无反应或超出范围 | 设置 min/max 约束 |
| 5 | **z-index 层级混乱** | 弹窗在最上层 | 弹窗被其他元素遮挡 | 统一的 z-index 层级规范 |

### 9.2 状态类问题（5 项）

| # | 问题 | 预期 | AI 常犯错误 | 正确做法 |
|---|------|------|------------|----------|
| 6 | **空状态未处理** | 显示友好提示 | 空白区域或报错 | 处理 `data.length === 0` |
| 7 | **加载状态未处理** | 显示加载动画 | 页面卡顿或闪烁 | 显示 Skeleton 或 Spinner |
| 8 | **错误状态未处理** | 显示错误提示 | 白屏或崩溃 | 显示 ErrorState + 重试按钮 |
| 9 | **禁用状态不完整** | 按钮不可点击 + 视觉变灰 | 视觉变灰但仍可点击 | 同时设置属性和样式 |
| 10 | **Loading 时仍可操作** | 提交中禁止重复点击 | 可以多次点击 | Loading 时禁用按钮 |

### 9.3 交互类问题（5 项）

| # | 问题 | 预期 | AI 常犯错误 | 正确做法 |
|---|------|------|------------|----------|
| 11 | **Focus ring 用错** | Tab 键聚焦显示，点击不显示 | 点击也显示 | 使用 `:focus-visible` |
| 12 | **Hover 状态残留** | 鼠标移开后恢复 | 触摸后 hover 粘住 | 使用 `@media (hover: hover)` |
| 13 | **键盘导航缺失** | Tab 可遍历所有可交互元素 | 某些按钮无法 Tab 到 | 正确设置 `tabIndex` |
| 14 | **点击区域太小** | 易于点击 | 按钮太小 | 最小 44×44px |
| 15 | **滚动穿透** | 弹窗打开时背景不滚动 | 背景也在滚动 | 锁定 body 滚动 |

### 9.4 内容边界问题（5 项）

| # | 问题 | 预期 | AI 常犯错误 | 正确做法 |
|---|------|------|------------|----------|
| 16 | **超长文本** | 截断或换行 | 文本溢出容器 | `text-overflow: ellipsis` |
| 17 | **超长单词** | 正确断行 | 单词撑破容器 | `overflow-wrap: break-word` |
| 18 | **空文本** | 显示占位符 | 布局塌陷 | 设置 `min-height` |
| 19 | **特殊字符** | 正确显示 | XSS 或显示异常 | 正确转义 |
| 20 | **极大数字** | 数字格式化 | 数字溢出 | 千分位或缩写 |

### 9.5 响应式问题（3 项）

| # | 问题 | 预期 | AI 常犯错误 | 正确做法 |
|---|------|------|------------|----------|
| 21 | **窗口缩放** | 布局自适应 | 布局错乱 | 相对单位和 Flex/Grid |
| 22 | **最小宽度** | 有底线宽度 | 内容被压缩到不可用 | 设置 `min-width` |
| 23 | **面板折叠** | 其他面板自动填充 | 空白残留 | `flex: 1` |

### 9.6 样式一致性问题（4 项）

| # | 问题 | 预期 | AI 常犯错误 | 正确做法 |
|---|------|------|------------|----------|
| 24 | **颜色硬编码** | 统一使用 Design Token | 颜色不一致 | CSS Variables |
| 25 | **间距不统一** | 4px 网格对齐 | 间距随意 | space token |
| 26 | **圆角不统一** | 统一圆角规范 | 各处圆角不同 | radius token |
| 27 | **字体不统一** | 统一字体规范 | 字体混乱 | typography token |

### 9.7 组件组合问题（3 项）

| # | 问题 | 说明 |
|---|------|------|
| 28 | **组件间状态不同步** | A 组件更新了数据，B 组件没刷新 |
| 29 | **事件冒泡冲突** | 点击子元素触发了父元素的事件 |
| 30 | **样式污染** | 一个组件的样式影响了另一个组件 |

### 9.8 路由和导航问题（3 项）

| # | 问题 | 说明 |
|---|------|------|
| 31 | **路由跳转后状态丢失** | 切换页面后之前的编辑内容没了 |
| 32 | **后退按钮行为异常** | 浏览器后退没有回到预期页面 |
| 33 | **深层链接失效** | 刷新页面后状态丢失 |

### 9.9 与后端对接问题（Layer 5 时检查，3 项）

| # | 问题 | 说明 |
|---|------|------|
| 34 | **API 错误未处理** | 后端返回错误时前端白屏 |
| 35 | **数据格式不匹配** | 前端期望数组，后端返回对象 |
| 36 | **并发请求冲突** | 多个请求同时发出，结果覆盖 |

---

## 十、如何使用检查表

1. **生成组件时**：在组件生成卡片中引用相关检查项
2. **AI 自检时**：AI 在提交前对照检查表自检
3. **人工验收时**：按检查表逐项确认
4. **问题复盘时**：发现问题后标记检查表中对应项，避免重犯
