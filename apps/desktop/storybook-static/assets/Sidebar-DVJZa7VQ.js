import{j as t}from"./jsx-runtime-BLchON5X.js";import{R as d}from"./index-DDi9LDaq.js";import{F as M}from"./FileTreePanel-ObtFQxJU.js";import{B as o}from"./Button-B9XLIlTV.js";import{I as u}from"./Input-BR80orUP.js";import"./Textarea-C3DI-yW7.js";import{C as $}from"./Card-D2dqmnxE.js";import"./ListItem-CyD6nTsv.js";import{T as l}from"./Text-CW-Kyc9R.js";import"./Heading-BzOyC2Oj.js";import"./Dialog-DJV5UiAm.js";import"./Popover-BMinsKFS.js";import{S as K}from"./Select-DBTPtHXT.js";import"./Checkbox-Ddw3urWg.js";import"./Tabs-DmRrGnuH.js";import"./Badge-0PIbcpDO.js";import"./Avatar-CFHo7YSR.js";import"./Spinner-BG3j59Um.js";import"./Skeleton-CwzwMFJo.js";import"./Tooltip-Ca9CUhYJ.js";import"./Toast-HPSiDIc2.js";import"./Accordion-F8I8yqG1.js";import"./Radio-DYZtN_dz.js";import{e as n,d as U}from"./kgStore-C8isvze5.js";import{S as Q}from"./SearchPanel-DTZGcJNa.js";function j(a){return a.entityType?`${a.name} (${a.entityType})`:a.name}function G(a){const c=n(e=>e.bootstrapStatus),r=n(e=>e.entities),T=n(e=>e.relations),x=n(e=>e.lastError),k=n(e=>e.bootstrapForProject),B=n(e=>e.clearError),q=n(e=>e.entityCreate),_=n(e=>e.entityUpdate),A=n(e=>e.entityDelete),L=n(e=>e.relationCreate),O=n(e=>e.relationUpdate),V=n(e=>e.relationDelete),[i,s]=d.useState({mode:"idle"}),[N,S]=d.useState(""),[w,E]=d.useState(""),[z,F]=d.useState(""),[y,g]=d.useState(""),[f,v]=d.useState(""),[D,W]=d.useState(""),h=c==="ready";d.useEffect(()=>{k(a.projectId)},[k,a.projectId]),d.useEffect(()=>{if(r.length===0){g(""),v("");return}if(r.some(e=>e.entityId===y)||g(r[0].entityId),!r.some(e=>e.entityId===f)){const e=r[1]?.entityId??r[0].entityId;v(e)}},[r,y,f]);async function Y(){(await q({name:N,entityType:w,description:z})).ok&&(S(""),E(""),F(""))}async function H(e){window.confirm("Delete this entity? Relations will be removed.")&&(await A({entityId:e}),i.mode==="entity"&&i.entityId===e&&s({mode:"idle"}))}async function R(){if(i.mode==="entity"){if(!(await _({entityId:i.entityId,patch:{name:i.name,entityType:i.entityType,description:i.description}})).ok)return;s({mode:"idle"});return}if(i.mode==="relation"){if(!(await O({relationId:i.relationId,patch:{relationType:i.relationType}})).ok)return;s({mode:"idle"});return}}async function J(){r.length===0||!(await L({fromEntityId:y,toEntityId:f,relationType:D})).ok||W("")}function P(e){const m=r.find(p=>p.entityId===e);return m?m.name:e}return t.jsxs("section",{"data-testid":"sidebar-kg",className:"flex flex-col gap-3 min-h-0",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-[var(--color-separator)]",children:[t.jsx(l,{size:"small",color:"muted",children:"Knowledge Graph"}),t.jsx(l,{size:"tiny",color:"muted",children:c})]}),x?t.jsxs("div",{role:"alert",className:"p-3 border-b border-[var(--color-separator)]",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx(l,{"data-testid":"kg-error-code",size:"code",color:"muted",children:x.code}),t.jsx(o,{variant:"secondary",size:"sm",onClick:B,className:"ml-auto",children:"Dismiss"})]}),t.jsx(l,{size:"small",className:"mt-1.5 block",children:x.message})]}):null,t.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:t.jsxs("div",{className:"p-3",children:[t.jsx(l,{size:"small",color:"muted",children:"Entities"}),t.jsxs("div",{className:"flex flex-col gap-2 mt-2 pb-3 border-b border-[var(--color-separator)]",children:[t.jsx(u,{"data-testid":"kg-entity-name",placeholder:"Name",value:N,onChange:e=>S(e.target.value),fullWidth:!0}),t.jsx(u,{placeholder:"Type (optional)",value:w,onChange:e=>E(e.target.value),fullWidth:!0}),t.jsx(u,{placeholder:"Description (optional)",value:z,onChange:e=>F(e.target.value),fullWidth:!0}),t.jsx(o,{"data-testid":"kg-entity-create",variant:"secondary",size:"sm",onClick:()=>{Y()},disabled:!h,className:"self-start",children:"Create entity"})]}),r.length===0?t.jsx(l,{size:"small",color:"muted",className:"mt-3 block",children:"No entities yet."}):t.jsx("div",{className:"mt-3 flex flex-col gap-2",children:r.map(e=>{const m=i.mode==="entity"&&i.entityId===e.entityId;return t.jsxs($,{"data-testid":`kg-entity-row-${e.entityId}`,noPadding:!0,className:"p-2.5 flex flex-col gap-2",children:[m?t.jsxs(t.Fragment,{children:[t.jsx(u,{value:i.name,onChange:p=>s({...i,name:p.target.value}),fullWidth:!0}),t.jsx(u,{value:i.entityType,onChange:p=>s({...i,entityType:p.target.value}),fullWidth:!0}),t.jsx(u,{value:i.description,onChange:p=>s({...i,description:p.target.value}),fullWidth:!0})]}):t.jsxs(t.Fragment,{children:[t.jsx(l,{size:"small",children:j({name:e.name,entityType:e.entityType})}),e.description?t.jsx(l,{size:"small",color:"muted",children:e.description}):null]}),t.jsx("div",{className:"flex gap-2",children:m?t.jsxs(t.Fragment,{children:[t.jsx(o,{variant:"secondary",size:"sm",onClick:()=>{R()},children:"Save"}),t.jsx(o,{variant:"ghost",size:"sm",onClick:()=>s({mode:"idle"}),children:"Cancel"})]}):t.jsxs(t.Fragment,{children:[t.jsx(o,{variant:"ghost",size:"sm",onClick:()=>s({mode:"entity",entityId:e.entityId,name:e.name,entityType:e.entityType??"",description:e.description??""}),children:"Edit"}),t.jsx(o,{"data-testid":`kg-entity-delete-${e.entityId}`,variant:"ghost",size:"sm",onClick:()=>{H(e.entityId)},children:"Delete"})]})})]},e.entityId)})}),t.jsxs("div",{className:"mt-4",children:[t.jsx(l,{size:"small",color:"muted",children:"Relations"}),t.jsxs("div",{className:"mt-2 flex flex-col gap-2 pb-3 border-b border-[var(--color-separator)]",children:[t.jsx(K,{value:y,onValueChange:e=>g(e),disabled:!h||r.length===0,options:r.map(e=>({value:e.entityId,label:j({name:e.name,entityType:e.entityType})})),placeholder:"Select entity...",fullWidth:!0}),t.jsx(K,{value:f,onValueChange:e=>v(e),disabled:!h||r.length===0,options:r.map(e=>({value:e.entityId,label:j({name:e.name,entityType:e.entityType})})),placeholder:"Select entity...",fullWidth:!0}),t.jsx(u,{"data-testid":"kg-relation-type",placeholder:"Relation type (e.g. knows)",value:D,onChange:e=>W(e.target.value),disabled:!h,fullWidth:!0}),t.jsx(o,{"data-testid":"kg-relation-create",variant:"secondary",size:"sm",onClick:()=>{J()},disabled:!h,className:"self-start",children:"Create relation"})]}),T.length===0?t.jsx(l,{size:"small",color:"muted",className:"mt-3 block",children:"No relations yet."}):t.jsx("div",{className:"mt-3 flex flex-col gap-2",children:T.map(e=>{const m=i.mode==="relation"&&i.relationId===e.relationId;return t.jsxs($,{"data-testid":`kg-relation-row-${e.relationId}`,noPadding:!0,className:"p-2.5 flex flex-col gap-2",children:[m?t.jsx(u,{value:i.relationType,onChange:p=>s({...i,relationType:p.target.value}),fullWidth:!0}):t.jsxs(l,{size:"small",children:[P(e.fromEntityId)," -(",e.relationType,")â†’"," ",P(e.toEntityId)]}),t.jsx("div",{className:"flex gap-2",children:m?t.jsxs(t.Fragment,{children:[t.jsx(o,{variant:"secondary",size:"sm",onClick:()=>{R()},children:"Save"}),t.jsx(o,{variant:"ghost",size:"sm",onClick:()=>s({mode:"idle"}),children:"Cancel"})]}):t.jsxs(t.Fragment,{children:[t.jsx(o,{variant:"ghost",size:"sm",onClick:()=>s({mode:"relation",relationId:e.relationId,relationType:e.relationType}),children:"Edit"}),t.jsx(o,{variant:"ghost",size:"sm",onClick:()=>{V({relationId:e.relationId})},children:"Delete"})]})})]},e.relationId)})})]})]})})]})}G.__docgenInfo={description:`KnowledgeGraphPanel renders the minimal KG CRUD surface.

Why: P0 requires KG discoverability (sidebar entry), CRUD, and predictable
data for context injection.`,methods:[],displayName:"KnowledgeGraphPanel",props:{projectId:{required:!0,tsType:{name:"string"},description:""}}};const b=["text-xs","px-2","py-1","rounded-[var(--radius-md)]","border","text-[var(--color-fg-default)]","cursor-pointer","transition-colors","duration-[var(--duration-fast)]","hover:bg-[var(--color-bg-hover)]","focus-visible:outline","focus-visible:outline-[length:var(--ring-focus-width)]","focus-visible:outline-offset-[var(--ring-focus-offset)]","focus-visible:outline-[var(--color-ring-focus)]"].join(" "),I="border-[var(--color-border-focus)] bg-[var(--color-bg-selected)]",C="border-[var(--color-border-default)] bg-[var(--color-bg-surface)]";function X(a){const[c,r]=d.useState("files");return a.collapsed?t.jsx("aside",{"data-testid":"layout-sidebar",className:"hidden w-0"}):t.jsxs("aside",{"data-testid":"layout-sidebar",className:"flex flex-col bg-[var(--color-bg-surface)] border-r border-[var(--color-separator)]",style:{width:a.width,minWidth:U.sidebar.min,maxWidth:U.sidebar.max},children:[t.jsxs("div",{className:"flex gap-1 p-2 border-b border-[var(--color-separator)]",children:[t.jsx("button",{type:"button",onClick:()=>r("files"),className:`${b} ${c==="files"?I:C}`,children:"Files"}),t.jsx("button",{type:"button",onClick:()=>r("search"),className:`${b} ${c==="search"?I:C}`,children:"Search"}),t.jsx("button",{type:"button",onClick:()=>r("kg"),className:`${b} ${c==="kg"?I:C}`,children:"KG"})]}),t.jsx("div",{className:"flex-1 min-h-0",children:a.projectId&&c==="files"?t.jsx(M,{projectId:a.projectId}):a.projectId&&c==="search"?t.jsx(Q,{projectId:a.projectId}):a.projectId&&c==="kg"?t.jsx(G,{projectId:a.projectId}):t.jsx("div",{className:"p-3 text-xs text-[var(--color-fg-muted)]",children:"Sidebar (no project)"})})]})}X.__docgenInfo={description:`Sidebar is the left panel container (Files/Outline/etc).

Why: P0 wires the Files tab as the minimal documents entry point with stable
selectors for Windows E2E.`,methods:[],displayName:"Sidebar",props:{width:{required:!0,tsType:{name:"number"},description:""},collapsed:{required:!0,tsType:{name:"boolean"},description:""},projectId:{required:!0,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};export{X as S};
