import{R as d}from"./index-DDi9LDaq.js";import{c as p}from"./react-Cb9lVK8B.js";const c=d.createContext(null);function o(n){return n.code==="TIMEOUT"?"timeout":n.code==="CANCELED"?"canceled":"error"}function m(n){return p((r,i)=>({status:"idle",stream:!0,selectedSkillId:"builtin:polish",skills:[],skillsStatus:"idle",skillsLastError:null,input:"",outputText:"",activeRunId:null,lastRunId:null,lastError:null,selectionRef:null,selectionText:"",proposal:null,applyStatus:"idle",setStream:t=>r({stream:t}),setSelectedSkillId:t=>r({selectedSkillId:t}),refreshSkills:async()=>{if(i().skillsStatus==="loading")return;r({skillsStatus:"loading",skillsLastError:null});const e=await n.invoke("skill:list",{includeDisabled:!0});if(!e.ok){r({skillsStatus:"error",skillsLastError:e.error});return}const l=i().selectedSkillId,u=e.data.items.some(a=>a.id===l),s=e.data.items.find(a=>a.enabled&&a.valid)?.id??l;r({skillsStatus:"ready",skills:e.data.items,skillsLastError:null,selectedSkillId:u?l:s})},setInput:t=>r({input:t}),clearError:()=>r({lastError:null}),setError:t=>r({lastError:t}),setSelectionSnapshot:t=>{r({selectionRef:t?.selectionRef??null,selectionText:t?.selectionText??""})},setProposal:t=>r({proposal:t,applyStatus:"idle"}),persistAiApply:async t=>{r({applyStatus:"applying",lastError:null});const e=await n.invoke("file:document:write",{projectId:t.projectId,documentId:t.documentId,contentJson:t.contentJson,actor:"ai",reason:`ai-apply:${t.runId}`});if(!e.ok){r({applyStatus:"idle",lastError:e.error});return}r({applyStatus:"applied",proposal:null,selectionRef:null,selectionText:""})},logAiApplyConflict:async t=>{await n.invoke("version:aiApply:logConflict",{documentId:t.documentId,runId:t.runId})},run:async t=>{const e=i();if(e.status==="running"||e.status==="streaming")return;const l=e.skills.find(a=>a.id===e.selectedSkillId)??null;if(l&&!l.enabled){r({status:"error",lastError:{code:"UNSUPPORTED",message:"Skill is disabled"}});return}if(l&&!l.valid){r({status:"error",lastError:{code:l.error_code??"INVALID_ARGUMENT",message:l.error_message??"Skill is invalid"}});return}const u=t?.inputOverride??e.input;r({status:"running",outputText:"",lastError:null,activeRunId:null,lastRunId:null,proposal:null,applyStatus:"idle"});const s=await n.invoke("ai:skill:run",{skillId:e.selectedSkillId,input:u,stream:e.stream,context:t?.context??{},promptDiagnostics:t?.promptDiagnostics});if(!s.ok){r({status:o(s.error),lastError:s.error,activeRunId:null,lastRunId:null});return}if(typeof s.data.outputText=="string"){r({status:"idle",outputText:s.data.outputText,activeRunId:null,lastRunId:s.data.runId});return}r({status:"running",activeRunId:s.data.runId,lastRunId:s.data.runId})},cancel:async()=>{const t=i();if(t.status!=="running"&&t.status!=="streaming"||!t.activeRunId)return;const e=t.activeRunId;r({status:"canceled",activeRunId:null,lastError:null});const l=await n.invoke("ai:skill:cancel",{runId:e});l.ok||r({status:o(l.error),lastError:l.error})},onStreamEvent:t=>{const e=i();if(!(!e.activeRunId||t.runId!==e.activeRunId)){if(t.type==="run_started"){r({status:"running"});return}if(t.type==="delta"){r(l=>({status:"streaming",outputText:`${l.outputText}${t.delta}`}));return}if(t.type==="run_completed"){r({status:"idle",activeRunId:null,lastRunId:t.runId});return}if(t.type==="run_canceled"){r({status:"canceled",activeRunId:null,lastRunId:t.runId});return}t.type==="run_failed"&&r({status:o(t.error),lastError:t.error,activeRunId:null,lastRunId:t.runId})}}}))}function I(n){return d.createElement(c.Provider,{value:n.store},n.children)}function S(n){const r=d.useContext(c);if(!r)throw new Error("AiStoreProvider is missing");return r(n)}I.__docgenInfo={description:"Provide an AI store instance for the Workbench UI.",methods:[],displayName:"AiStoreProvider",props:{store:{required:!0,tsType:{name:"ReturnType",elements:[{name:"createAiStore"}],raw:"ReturnType<typeof createAiStore>"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};export{I as A,m as c,S as u};
