import{j as v}from"./jsx-runtime-BLchON5X.js";import{R as d}from"./index-DDi9LDaq.js";import{c as m}from"./react-Cb9lVK8B.js";const l=d.createContext(null);function C(o){return m((e,n)=>({bootstrapStatus:"idle",projectId:null,documentId:null,documentContentJson:null,editor:null,lastSavedOrQueuedJson:null,autosaveStatus:"idle",autosaveError:null,setAutosaveStatus:t=>e({autosaveStatus:t}),clearAutosaveError:()=>e({autosaveError:null}),setEditorInstance:t=>e({editor:t}),bootstrapForProject:async t=>{e({bootstrapStatus:"loading"});let r=null;const a=await o.invoke("file:document:getCurrent",{projectId:t});if(a.ok)r=a.data.documentId;else if(a.error.code==="NOT_FOUND"){const i=await o.invoke("file:document:list",{projectId:t});if(!i.ok){e({bootstrapStatus:"error"});return}if(r=i.data.items[0]?.documentId??null,!r){const s=await o.invoke("file:document:create",{projectId:t});if(!s.ok){e({bootstrapStatus:"error"});return}r=s.data.documentId}if(!(await o.invoke("file:document:setCurrent",{projectId:t,documentId:r})).ok){e({bootstrapStatus:"error"});return}}else{e({bootstrapStatus:"error"});return}if(!r){e({bootstrapStatus:"ready",projectId:t,documentId:null});return}const u=await o.invoke("file:document:read",{projectId:t,documentId:r});if(!u.ok){e({bootstrapStatus:"error"});return}e({bootstrapStatus:"ready",projectId:t,documentId:r,documentContentJson:u.data.contentJson,lastSavedOrQueuedJson:u.data.contentJson,autosaveStatus:"idle",autosaveError:null})},openDocument:async({projectId:t,documentId:r})=>{e({bootstrapStatus:"loading",projectId:t,autosaveError:null});const a=await o.invoke("file:document:read",{projectId:t,documentId:r});if(!a.ok){e({bootstrapStatus:"error"});return}e({bootstrapStatus:"ready",projectId:t,documentId:r,documentContentJson:a.data.contentJson,lastSavedOrQueuedJson:a.data.contentJson,autosaveStatus:"idle",autosaveError:null})},openCurrentDocumentForProject:async t=>{e({bootstrapStatus:"loading",projectId:t,autosaveError:null});const r=await o.invoke("file:document:getCurrent",{projectId:t});if(r.ok){await n().openDocument({projectId:t,documentId:r.data.documentId});return}if(r.error.code==="NOT_FOUND"){e({bootstrapStatus:"ready",projectId:t,documentId:null,documentContentJson:null,lastSavedOrQueuedJson:null,autosaveStatus:"idle",autosaveError:null});return}e({bootstrapStatus:"error"})},save:async({projectId:t,documentId:r,contentJson:a,actor:u,reason:i})=>{n().projectId===t&&n().documentId===r&&e({autosaveStatus:"saving",lastSavedOrQueuedJson:a});const s=await o.invoke("file:document:write",{projectId:t,documentId:r,contentJson:a,actor:u,reason:i});if(!s.ok){n().projectId===t&&n().documentId===r&&e({autosaveStatus:"error",autosaveError:s.error});return}n().projectId===t&&n().documentId===r&&e({autosaveStatus:"saved",autosaveError:null})},retryLastAutosave:async()=>{const t=n();!t.projectId||!t.documentId||!t.lastSavedOrQueuedJson||t.lastSavedOrQueuedJson.length===0||(e({autosaveError:null}),await t.save({projectId:t.projectId,documentId:t.documentId,contentJson:t.lastSavedOrQueuedJson,actor:"auto",reason:"autosave"}))}}))}function S(o){return v.jsx(l.Provider,{value:o.store,children:o.children})}function y(o){const e=d.useContext(l);if(!e)throw new Error("EditorStoreProvider is missing");return e(o)}S.__docgenInfo={description:"Provide an editor store instance for the Workbench UI.",methods:[],displayName:"EditorStoreProvider",props:{store:{required:!0,tsType:{name:"ReturnType",elements:[{name:"createEditorStore"}],raw:"ReturnType<typeof createEditorStore>"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};export{S as E,C as c,y as u};
