import{j as e}from"./jsx-runtime-BLchON5X.js";import{C as o}from"./Card-D2dqmnxE.js";import{T as t}from"./Text-CW-Kyc9R.js";import{u as n}from"./contextStore-Cf33-zum.js";const l=[{id:"rules",label:"Rules",testId:"ai-context-layer-rules"},{id:"settings",label:"Settings",testId:"ai-context-layer-settings"},{id:"retrieved",label:"Retrieved",testId:"ai-context-layer-retrieved"},{id:"immediate",label:"Immediate",testId:"ai-context-layer-immediate"}];function c(){const d=n(s=>s.status),r=n(s=>s.assembled);if(!r)return e.jsx(o,{"data-testid":"ai-context-panel",className:"p-2.5 rounded-[var(--radius-md)]",children:e.jsx(t,{size:"small",color:"muted",children:d==="loading"?"Loading context…":"No context yet"})});const i=r.trimEvidence.filter(s=>s.action!=="kept"||s.reason==="read_error");return e.jsxs(o,{"data-testid":"ai-context-panel",className:"flex flex-col gap-2.5 p-2.5 rounded-[var(--radius-md)] min-h-0",children:[e.jsxs("header",{className:"flex items-baseline gap-2.5",children:[e.jsx(t,{size:"small",children:"Context"}),e.jsx(t,{size:"tiny",color:"muted",className:"ml-auto",children:d})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[e.jsxs("div",{children:[e.jsx(t,{size:"tiny",color:"muted",children:"stablePrefixHash"}),e.jsx(t,{"data-testid":"ai-context-stable-prefix-hash",size:"code",as:"div",className:"text-[11px]",children:r.hashes.stablePrefixHash})]}),e.jsxs("div",{children:[e.jsx(t,{size:"tiny",color:"muted",children:"promptHash"}),e.jsx(t,{"data-testid":"ai-context-prompt-hash",size:"code",as:"div",className:"text-[11px]",children:r.hashes.promptHash})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2.5 p-2.5 border border-[var(--color-separator)] rounded-[var(--radius-md)]",children:[e.jsxs("div",{children:[e.jsx(t,{size:"tiny",color:"muted",children:"rules"}),e.jsx(t,{size:"code",as:"div",className:"text-[11px]",children:r.budget.estimate.rulesTokens})]}),e.jsxs("div",{children:[e.jsx(t,{size:"tiny",color:"muted",children:"settings"}),e.jsx(t,{size:"code",as:"div",className:"text-[11px]",children:r.budget.estimate.settingsTokens})]}),e.jsxs("div",{children:[e.jsx(t,{size:"tiny",color:"muted",children:"retrieved"}),e.jsx(t,{size:"code",as:"div",className:"text-[11px]",children:r.budget.estimate.retrievedTokens})]}),e.jsxs("div",{children:[e.jsx(t,{size:"tiny",color:"muted",children:"immediate"}),e.jsx(t,{size:"code",as:"div",className:"text-[11px]",children:r.budget.estimate.immediateTokens})]}),e.jsxs("div",{children:[e.jsx(t,{size:"tiny",color:"muted",children:"total"}),e.jsxs(t,{size:"code",as:"div",className:"text-[11px]",children:[r.budget.estimate.totalTokens,"/",r.budget.maxInputTokens]})]})]}),e.jsx("div",{className:"flex flex-col gap-2.5 min-h-0",children:l.map(s=>e.jsxs("section",{"data-testid":s.testId,children:[e.jsx(t,{size:"tiny",color:"muted",as:"div",className:"mb-1.5",children:s.label}),e.jsx("pre",{className:"m-0 whitespace-pre-wrap break-words text-xs leading-[18px] text-[var(--color-fg-base)] font-[var(--font-family-mono)] border border-[var(--color-separator)] rounded-[var(--radius-md)] p-2.5 bg-transparent max-h-[180px] overflow-auto",children:r.layers[s.id]})]},s.id))}),e.jsxs("section",{"data-testid":"ai-context-trim",children:[e.jsxs(t,{size:"tiny",color:"muted",children:["TrimEvidence (",i.length,")"]}),e.jsx("div",{className:"mt-1.5 border border-[var(--color-separator)] rounded-[var(--radius-md)] p-2.5 bg-transparent max-h-[140px] overflow-auto flex flex-col gap-1.5 font-[var(--font-family-mono)] text-[11px] text-[var(--color-fg-muted)]",children:i.length===0?e.jsx("div",{children:"(none)"}):i.map((s,a)=>e.jsxs("div",{children:[s.layer," ",s.action," ",s.reason," ",s.sourceRef," (",s.beforeChars,"→",s.afterChars,")"]},`${s.layer}:${s.sourceRef}:${a}`))})]}),e.jsxs("section",{children:[e.jsxs(t,{size:"tiny",color:"muted",children:["RedactionEvidence (",r.redactionEvidence.length,")"]}),e.jsx("div",{className:"mt-1.5 border border-[var(--color-separator)] rounded-[var(--radius-md)] p-2.5 bg-transparent max-h-[120px] overflow-auto flex flex-col gap-1.5 font-[var(--font-family-mono)] text-[11px] text-[var(--color-fg-muted)]",children:r.redactionEvidence.length===0?e.jsx("div",{children:"(none)"}):r.redactionEvidence.map((s,a)=>e.jsxs("div",{children:[s.patternId," ",s.matchCount," ",s.sourceRef]},`${s.patternId}:${s.sourceRef}:${a}`))})]})]})}c.__docgenInfo={description:`ContextViewer renders the assembled AI context with evidence and hashes.

Why: CNWB-REQ-060 requires an inspectable, E2E-assertable UI surface for
context layers, trimming, and redaction (without leaking secrets/abs paths).`,methods:[],displayName:"ContextViewer"};export{c as C};
