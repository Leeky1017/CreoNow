import{j as t}from"./jsx-runtime-BLchON5X.js";import{R as l}from"./index-DDi9LDaq.js";import{B as c}from"./Button-B9XLIlTV.js";import{I as b}from"./Input-BR80orUP.js";import{T as M}from"./Textarea-C3DI-yW7.js";import{C as o}from"./Card-D2dqmnxE.js";import"./ListItem-CyD6nTsv.js";import{T as s}from"./Text-CW-Kyc9R.js";import"./Heading-BzOyC2Oj.js";import"./Dialog-DJV5UiAm.js";import"./Popover-BMinsKFS.js";import{S as C}from"./Select-DBTPtHXT.js";import{C as h}from"./Checkbox-Ddw3urWg.js";import"./Tabs-DmRrGnuH.js";import"./Badge-0PIbcpDO.js";import"./Avatar-CFHo7YSR.js";import"./Spinner-BG3j59Um.js";import"./Skeleton-CwzwMFJo.js";import"./Tooltip-Ca9CUhYJ.js";import"./Toast-HPSiDIc2.js";import"./Accordion-F8I8yqG1.js";import"./Radio-DYZtN_dz.js";import{u as L}from"./projectStore-wjKW615C.js";import{u as r}from"./memoryStore-CgfBSG-J.js";function R(){const i=L(e=>e.current?.projectId??null),N=r(e=>e.bootstrapStatus),m=r(e=>e.items),a=r(e=>e.settings),p=r(e=>e.preview),u=r(e=>e.lastError),x=r(e=>e.bootstrapForProject),z=r(e=>e.create),w=r(e=>e.remove),n=r(e=>e.updateSettings),P=r(e=>e.previewInjection),k=r(e=>e.clearPreview),I=r(e=>e.clearError),[j,S]=l.useState("preference"),[d,g]=l.useState("global"),[f,v]=l.useState(""),[y,E]=l.useState("");l.useEffect(()=>{x(i)},[x,i]),l.useEffect(()=>{i===null&&d==="project"&&g("global")},[d,i]);const T=i===null;return t.jsxs("section",{"data-testid":"memory-panel",className:"flex flex-col gap-3 p-3 min-h-0",children:[t.jsxs("header",{className:"flex items-center gap-2",children:[t.jsx(s,{size:"small",color:"muted",children:"Memory"}),t.jsx(s,{size:"tiny",color:"muted",className:"ml-auto",children:N})]}),u?t.jsxs(o,{noPadding:!0,className:"p-2.5",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx(s,{"data-testid":"memory-error-code",size:"code",color:"muted",children:u.code}),t.jsx(c,{variant:"ghost",size:"sm",onClick:I,className:"ml-auto",children:"Dismiss"})]}),t.jsx(s,{size:"small",color:"muted",className:"mt-1.5 block",children:u.message})]}):null,t.jsxs(o,{noPadding:!0,className:"p-2.5 flex flex-col gap-2",children:[t.jsx(s,{size:"small",color:"muted",children:"Settings"}),t.jsx(h,{"data-testid":"memory-settings-injection",checked:a?.injectionEnabled??!0,onCheckedChange:e=>{n({patch:{injectionEnabled:e===!0}})},disabled:!a,label:"Injection enabled"}),t.jsx(h,{"data-testid":"memory-settings-learning",checked:a?.preferenceLearningEnabled??!0,onCheckedChange:e=>{n({patch:{preferenceLearningEnabled:e===!0}})},disabled:!a,label:"Preference learning enabled"}),t.jsx(h,{"data-testid":"memory-settings-privacy",checked:a?.privacyModeEnabled??!1,onCheckedChange:e=>{n({patch:{privacyModeEnabled:e===!0}})},disabled:!a,label:"Privacy mode"}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx(s,{size:"small",color:"muted",children:"Threshold"}),t.jsx(b,{"data-testid":"memory-settings-threshold",type:"number",min:1,max:100,value:a?.preferenceLearningThreshold??3,onChange:e=>{n({patch:{preferenceLearningThreshold:Number(e.target.value)}})},disabled:!a,className:"ml-auto w-20 h-7"})]})]}),t.jsxs(o,{noPadding:!0,className:"p-2.5 flex flex-col gap-2",children:[t.jsx(s,{size:"small",color:"muted",children:"Create"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(C,{"data-testid":"memory-create-type",value:j,onValueChange:e=>S(e),options:[{value:"preference",label:"preference"},{value:"fact",label:"fact"},{value:"note",label:"note"}],className:"flex-1"}),t.jsx(C,{"data-testid":"memory-create-scope",value:d,onValueChange:e=>g(e),options:[{value:"global",label:"global"},{value:"project",label:"project",disabled:T}],className:"flex-1"})]}),t.jsx(M,{"data-testid":"memory-create-content",value:f,onChange:e=>v(e.target.value),placeholder:"Write a preference / fact / note...",fullWidth:!0,className:"min-h-[54px]"}),t.jsx(c,{"data-testid":"memory-create-submit",variant:"ghost",size:"md",onClick:()=>{(async()=>{(await z({type:j,scope:d,content:f})).ok&&v("")})()},children:"Add"})]}),t.jsxs(o,{noPadding:!0,className:"p-2.5 min-h-[120px] flex-1 overflow-auto flex flex-col gap-2",children:[t.jsxs(s,{size:"small",color:"muted",children:["Items (",m.length,")"]}),m.length===0?t.jsx(s,{size:"small",color:"muted",children:"No memories yet."}):null,m.map(e=>t.jsxs(o,{"data-testid":`memory-item-${e.memoryId}`,noPadding:!0,className:"p-2 flex gap-2 items-start",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex gap-1.5",children:[t.jsx(s,{size:"code",color:"muted",children:e.type}),t.jsx(s,{size:"code",color:"muted",children:e.scope}),t.jsx(s,{size:"code",color:"muted",children:e.origin})]}),t.jsx(s,{size:"small",className:"mt-1.5 block whitespace-pre-wrap break-words",children:e.content})]}),t.jsx(c,{"data-testid":`memory-delete-${e.memoryId}`,variant:"ghost",size:"sm",onClick:()=>{w({memoryId:e.memoryId})},children:"Delete"})]},e.memoryId))]}),t.jsxs(o,{noPadding:!0,className:"p-2.5 flex flex-col gap-2",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx(s,{size:"small",color:"muted",children:"Injection preview"}),t.jsx(c,{"data-testid":"memory-preview-run",variant:"ghost",size:"sm",onClick:()=>{P({queryText:y})},className:"ml-auto",children:"Preview"}),t.jsx(c,{"data-testid":"memory-preview-clear",variant:"ghost",size:"sm",onClick:k,children:"Clear"})]}),t.jsx(b,{"data-testid":"memory-preview-query",type:"text",value:y,onChange:e=>E(e.target.value),placeholder:"queryText (optional)",fullWidth:!0}),p?t.jsxs(o,{"data-testid":"memory-preview-result",noPadding:!0,className:"p-2",children:[t.jsxs(s,{size:"small",color:"muted",children:["mode: ",t.jsx(s,{size:"code",color:"muted",children:p.mode})]}),t.jsxs(s,{size:"small",color:"muted",className:"mt-1.5 block",children:["items: ",t.jsx(s,{size:"code",color:"muted",children:p.items.length})]})]}):null]})]})}R.__docgenInfo={description:"MemoryPanel is the minimal UI surface for memory CRUD/settings/preview.",methods:[],displayName:"MemoryPanel"};export{R as M};
