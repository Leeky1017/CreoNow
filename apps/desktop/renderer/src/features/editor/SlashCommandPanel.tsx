import {
  filterSlashCommands,
  type SlashCommandDefinition,
  type SlashCommandId,
} from "./slashCommands";

interface SlashCommandPanelProps {
  open: boolean;
  query: string;
  candidates: SlashCommandDefinition[];
  onQueryChange: (query: string) => void;
  onSelectCommand: (commandId: SlashCommandId) => void;
  onRequestClose: () => void;
}

export function SlashCommandPanel(
  props: SlashCommandPanelProps,
): JSX.Element | null {
  if (!props.open) {
    return null;
  }

  const filteredCandidates = filterSlashCommands(props.candidates, props.query);

  return (
    <div
      data-testid="slash-command-panel"
      className="border-b border-[var(--color-border-default)] bg-[var(--color-bg-raised)] px-3 py-2"
    >
      <input
        data-testid="slash-command-search-input"
        type="text"
        value={props.query}
        placeholder="Search slash commands..."
        onChange={(event) => props.onQueryChange(event.target.value)}
        onKeyDown={(event) => {
          if (event.key !== "Escape") {
            return;
          }
          event.preventDefault();
          props.onRequestClose();
        }}
        className="mb-2 h-8 w-full rounded-[var(--radius-sm)] border border-[var(--color-border-default)] bg-[var(--color-bg-surface)] px-2 text-sm text-[var(--color-fg-default)] outline-none"
      />

      {filteredCandidates.length === 0 ? (
        <div
          data-testid="slash-command-empty-state"
          className="rounded-[var(--radius-sm)] bg-[var(--color-bg-surface)] px-2 py-2 text-sm text-[var(--color-fg-muted)]"
        >
          No commands found.
        </div>
      ) : (
        <ul className="space-y-1">
          {filteredCandidates.map((candidate) => (
            <li
              key={candidate.id}
              className="rounded-[var(--radius-sm)] bg-[var(--color-bg-surface)]"
            >
              <button
                type="button"
                data-testid={`slash-command-item-${candidate.id}`}
                onClick={() => props.onSelectCommand(candidate.id)}
                className="w-full rounded-[var(--radius-sm)] px-2 py-2 text-left hover:bg-[var(--color-bg-hover)]"
              >
                <p className="text-sm text-[var(--color-fg-default)]">
                  {candidate.label}
                </p>
                <p className="text-xs text-[var(--color-fg-muted)]">
                  {candidate.description}
                </p>
              </button>
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}
